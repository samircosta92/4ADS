<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="css/styleCadastro.css">
    <title>Excluir Livro</title>
    <style>

        table,tr,th,td {
            border: 2px solid black;
            border-collapse: collapse;
            padding-left: 50px;
            padding-right: 50px;
            text-align: center;
            color: navy;
        }
    </style>
    <script>


        function enviaForm() {
            let objLivro = document.getElementById("formLivro");
            let cod = document.getElementById("cod");

            erro = validaCodigo(cod);


            if (erro == 0) {
                let xmlhttp = new XMLHttpRequest();

                xmlhttp.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {


                        if(JSON.parse(this.responseText) != "Não existe produto com o código correspondente!") {
                            let result = JSON.parse(this.responseText);
                            var table = document.getElementById("table")

                            var linha = document.createElement("tr");
                            var campo_cod = document.createElement("td");
                            var campo_nome = document.createElement("td");
                            var campo_aut = document.createElement("td");
                            var campo_edit = document.createElement("td");
                            var campo_qtd = document.createElement("td");
                            var campo_link = document.createElement("td");


                            var texto_cod = document.createTextNode(result[0]);
                            var texto_nome = document.createTextNode(result[1]);
                            var texto_aut = document.createTextNode(result[2]);
                            var texto_edit = document.createTextNode(result[3]);
                            var texto_qtd = document.createTextNode(result[4]);
                            var texto_link = document.createTextNode(result[5]);

                            campo_cod.appendChild(texto_cod);
                            campo_nome.appendChild(texto_nome);
                            campo_aut.appendChild(texto_aut);
                            campo_edit.appendChild(texto_edit);
                            campo_qtd.appendChild(texto_qtd);
                            campo_link.appendChild(texto_link);

                            linha.appendChild(campo_cod);
                            linha.appendChild(campo_nome)
                            linha.appendChild(campo_aut)
                            linha.appendChild(campo_edit);
                            linha.appendChild(campo_qtd)
                            linha.appendChild(campo_link);

                            table.appendChild(linha);

                            var form = document.getElementById("formLivro");
                            var button = document.createElement('button');
                            button.setAttribute('type','submit')
                            button.appendChild(document.createTextNode('Deseja realmente excluir?'));
                            form.appendChild(button);

                        }
                        else
                        {
                            document.getElementById("resposta").innerHTML = JSON.parse(this.responseText);
                        }


                    }

                }


                xmlhttp.open("GET", "http://localhost/4ADS/EXCLUIR_LIVRO.php?codigo=" + objLivro.cod.value, true);
                xmlhttp.send();

            }

            function validaCodigo(cod)
            {
                let erroCod = 0;
                if(cod.value.length !=5) {
                    document.getElementById("resposta").innerHTML = "Código Invalido!<br>";
                    erroCod = 1;
                }
                return(erroCod);
            }


        }



    </script>
</head>
<body>
<header>
    <hr>
    <h2>SISTEMA PARA GERENCIAMENTO DA BIBLIOTECA</h2>
    <hr>
</header>
<form action="CONFIRMA_EXCLUSÃO.php" method="post" name="livro" id="formLivro">
    <fieldset class="fieldclass" name="identificação">
        Código:<input onchange="enviaForm()" type="number"  name="cod" id="cod"><br><br>
    </fieldset>
</form>
<table id="table">
    <tr>
        <th>Código</th>
        <th>Nome</th>
        <th>Autor</th>
        <th>Editora</th>
        <th>Quantidade</th>
        <th>Link da Imagem</th>
    </tr>
</table>
<span id="resposta"></span>
<figure style="text-align:left">
    <a href="CRUD_ACERVO.html"><img src="imagem/voltar.png" width="50px" height="35px"></a>
</figure>
</fieldset>
<footer style="margin-top: 250px ">
    <h4>Samir Costa & Wesley Xavier - 4ADS - 2021.2</h4>
</footer>
</body>
</html>